#!/usr/bin/env sh

if [ "$(uname)" = "Emscripten" ]; then
  TARGET="wasm32-unknown-emscripten"
  rust_toolchain=nightly-2025-01-05
  # Polars uses very recent nightly features, so we need to update the toolchain
  cat <<EOF
It seems that building for Emscripten.
This requires a very recent Rust nightly toolchain.
So executing 'rustup toolchain install nightly'...
EOF
  rustup toolchain uninstall nightly
  rustup toolchain install "${rust_toolchain}" --force --component rust-src
  rustup override set "${rust_toolchain}"
fi

sed -e "s/@TARGET@/${TARGET}/" src/Makevars.in > src/Makevars
